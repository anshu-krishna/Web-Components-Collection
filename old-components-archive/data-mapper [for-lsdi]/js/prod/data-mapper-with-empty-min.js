function is2DArray(t,e=null){if(!Array.isArray(t))return!1;for(const r of t){if(!Array.isArray(r))return!1;if(null!==e&&r.length!==e)return!1}return!0}function genNode(t,e={}){const r=document.createElement("div");r.innerText=t;for(const[t,n]of Object.entries(e))r.setAttribute(t,n);return r.outerHTML}const FormatFuncs={switch:function(t,e=null,...r){for(const e of r)if(Array.isArray(e)&&2===e.length&&t===e[0])return e[1];return e},str:function(t){return String(t)},"str.slice":function(t,e=0,r=null){return"number"==typeof e?"number"==typeof r?String(t).slice(e,r):String(t).slice(e):null},"str.part":function(t,e=0,r=null){return"number"==typeof e?"number"==typeof r?String(t).substring(e,e+r):String(t).substring(e):null},"str.trim":function(t){return String(t).trim()},"str.trim.l":function(t){return String(t).trimStart()},"str.trim.r":function(t){return String(t).trimEnd()},"str.pad.l":function(t,e,r=" "){return String(t).padStart(e,r)},"str.pad.r":function(t,e,r=" "){return String(t).padEnd(e,r)},"str.upper":function(t){return String(t).toUpperCase()},"str.lower":function(t){return String(t).toLowerCase()},"str.title":function(t){return String(t).replace(/\w\S*/g,(t=>`${t.charAt(0).toUpperCase()}${t.slice(1).toLowerCase()}`))},"str.replace":function(t,e="",r=""){return String(t).replaceAll(e,r)},"str.at":function(t,e=0){return String(t).at(e)},num:function(t){return Number(t)},"num.add":function(t,e=0){return Number(t)+Number(e)},"num.sub":function(t,e=0){return Number(t)-Number(e)},"num.mul":function(t,e=1){return Number(t)*Number(e)},"num.div":function(t,e=1){return 0!==(e=Number(e))?Number(t)/e:null},"num.mod":function(t,e=2){return 0!==(e=Number(e))?Number(t)%e:null},"num.exp":function(t,e=1){return Number(t)**Number(e)},"num.round":function(t,e=2){return Number(t).toFixed(Number(e))},"num.in_range":function(t,e=null,r=null){return t=Number(t),!("number"==typeof e&&t<e)&&!("number"==typeof r&&t>r)},bool:function(t){return Boolean(t)}},FuncList=Object.keys(FormatFuncs),PEG=function(){"use strict";function t(e,r,n,o){this.message=e,this.expected=r,this.found=n,this.location=o,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,t)}return function(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}(t,Error),t.buildMessage=function(t,e){let r={literal:function(t){return'"'+o(t.text)+'"'},class:function(t){let e,r="";for(e=0;e<t.parts.length;e++)r+=t.parts[e]instanceof Array?a(t.parts[e][0])+"-"+a(t.parts[e][1]):a(t.parts[e]);return"["+(t.inverted?"^":"")+r+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function o(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function a(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}return"Expected "+function(t){let e,n,o=new Array(t.length);for(e=0;e<t.length;e++)o[e]=(a=t[e],r[a.type](a));var a;if(o.sort(),o.length>0){for(e=1,n=1;e<o.length;e++)o[e-1]!==o[e]&&(o[n]=o[e],n++);o.length=n}switch(o.length){case 1:return o[0];case 2:return o[0]+" or "+o[1];default:return o.slice(0,-1).join(", ")+", or "+o[o.length-1]}}(t)+" but "+function(t){return t?'"'+o(t)+'"':"end of input"}(e)+" found."},{SyntaxError:t,parse:function(e,r){r=void 0!==r?r:{};let n,o={},a={Exp:Wt},i=Wt,s=Vt("Txt-Exp Chain"),l=Vt("Expression"),u=It("{",!1),c=It("}",!1),d=Vt("ColID"),p=Vt("Function"),h=It("=>",!1),f=It("(",!1),m=function(t,e,r){return r},g=It(")",!1),b=Vt("Value"),w=Vt("Null"),v="null",y=It("null",!1),x=Vt("False"),C="false",A=It("false",!1),E=Vt("True"),S="true",F=It("true",!1),k=Vt("Object"),L=function(t,e){return e},N=Vt("{Key:Value}"),H=Vt("Key-Chain"),T=".",D=It(".",!1),$=function(){return Ut()},O=Vt("Key"),z=/^[_a-z$]/i,_=Rt(["_",["a","z"],"$"],!1,!0),j=/^[0-9a-z$_]/i,P=Rt([["0","9"],["a","z"],"$","_"],!1,!0),M=It(":",!1),q=Vt("Array"),U=It("[",!1),I=function(t,e){return e},R=It("]",!1),V=Vt("Number"),J="-",K=It("-",!1),G=/^[eE]/,B=Rt(["e","E"],!1,!1),W=It("+",!1),Q=It("0",!1),X=/^[1-9]/,Y=Rt([["1","9"]],!1,!1),Z=Vt("String"),tt=It('"',!1),et=function(t){return t.join("")},rt=It("'",!1),nt=It("`",!1),ot=/^[^\0-\x1F\\"]/,at=Rt([["\0",""],"\\",'"'],!0,!1),it=/^[^\0-\x1F\\']/,st=Rt([["\0",""],"\\","'"],!0,!1),lt=/^[^\0-\x1F\\`]/,ut=Rt([["\0",""],"\\","`"],!0,!1),ct=Vt("Escaped-Char"),dt=It("\\\\",!1),pt=It('\\"',!1),ht=It("\\'",!1),ft=It("\\`",!1),mt=It("\\b",!1),gt=It("\\f",!1),bt=It("\\n",!1),wt=It("\\r",!1),vt=It("\\t",!1),yt=It("\\u",!1),xt=Vt("Text"),Ct=/^[^\\{]/,At=Rt(["\\","{"],!0,!1),Et="\\{",St=It("\\{",!1),Ft=Vt("Digit[0-9]"),kt=/^[0-9]/,Lt=Rt([["0","9"]],!1,!1),Nt=It(",",!1),Ht=Vt("Whitespace"),Tt=/^[ \t\n\r]/,Dt=Rt([" ","\t","\n","\r"],!1,!1),$t=/^[0-9a-f]/i,Ot=Rt([["0","9"],["a","f"]],!1,!0),zt=0,_t=0,jt=[{line:1,column:1}],Pt=0,Mt=[],qt=0;if("startRule"in r){if(!(r.startRule in a))throw new Error("Can't start parsing from rule \""+r.startRule+'".');i=a[r.startRule]}function Ut(){return e.substring(_t,zt)}function It(t,e){return{type:"literal",text:t,ignoreCase:e}}function Rt(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function Vt(t){return{type:"other",description:t}}function Jt(t){let r,n=jt[t];if(n)return n;for(r=t-1;!jt[r];)r--;for(n=jt[r],n={line:n.line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return jt[t]=n,n}function Kt(t,e){let r=Jt(t),n=Jt(e);return{start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:n.line,column:n.column}}}function Gt(t){zt<Pt||(zt>Pt&&(Pt=zt,Mt=[]),Mt.push(t))}function Bt(e,r,n){return new t(t.buildMessage(e,r),e,r,n)}function Wt(){let t,e,r,n;if(qt++,t=zt,e=le(),e===o&&(e=null),e!==o){for(r=[],n=Qt();n!==o;)r.push(n),n=Qt();r!==o?(_t=t,e=function(t,e){let r=[];""!==t&&r.push({ty:"txt",val:t});for(const t of e)r.push(t[0]),""!==t[1]&&r.push({ty:"txt",val:t[1]});return r}(e,r),t=e):(zt=t,t=o)}else zt=t,t=o;return qt--,t===o&&(e=o,0===qt&&Gt(s)),t}function Qt(){let t,r,n,a,i,s,p,h,f;if(qt++,t=zt,123===e.charCodeAt(zt)?(r="{",zt++):(r=o,0===qt&&Gt(u)),r!==o)if(n=de(),n!==o)if(a=function(){let t,e;qt++,t=zt,e=re(),e!==o&&(_t=t,e=parseInt(Ut()));t=e,t===o&&(t=ne());qt--,t===o&&(e=o,0===qt&&Gt(d));return t}(),a!==o)if(i=de(),i!==o){for(s=[],p=Xt();p!==o;)s.push(p),p=Xt();s!==o?(p=de(),p!==o?(125===e.charCodeAt(zt)?(h="}",zt++):(h=o,0===qt&&Gt(c)),h!==o?(f=le(),f===o&&(f=null),f!==o?(_t=t,r=[{ty:"exp",col:a,maps:s},f??""],t=r):(zt=t,t=o)):(zt=t,t=o)):(zt=t,t=o)):(zt=t,t=o)}else zt=t,t=o;else zt=t,t=o;else zt=t,t=o;else zt=t,t=o;return qt--,t===o&&(r=o,0===qt&&Gt(l)),t}function Xt(){let t,r,n,a,i,s,l,u,c,d,b,w,v,y,x;if(qt++,t=zt,r=de(),r!==o)if("=>"===e.substr(zt,2)?(n="=>",zt+=2):(n=o,0===qt&&Gt(h)),n!==o)if(a=de(),a!==o)if(i=te(),i!==o){if(s=zt,l=de(),l!==o)if(40===e.charCodeAt(zt)?(u="(",zt++):(u=o,0===qt&&Gt(f)),u!==o)if(c=de(),c!==o){if(d=zt,b=Yt(),b!==o){for(w=[],v=zt,y=ce(),y!==o?(x=Yt(),x!==o?(_t=v,y=m(0,0,x),v=y):(zt=v,v=o)):(zt=v,v=o);v!==o;)w.push(v),v=zt,y=ce(),y!==o?(x=Yt(),x!==o?(_t=v,y=m(0,0,x),v=y):(zt=v,v=o)):(zt=v,v=o);w!==o?(v=ce(),v===o&&(v=null),v!==o?(_t=d,C=w,b=[b,...C],d=b):(zt=d,d=o)):(zt=d,d=o)}else zt=d,d=o;d===o&&(d=null),d!==o?(b=de(),b!==o?(41===e.charCodeAt(zt)?(w=")",zt++):(w=o,0===qt&&Gt(g)),w!==o?(v=de(),v!==o?(_t=s,l=d??[],s=l):(zt=s,s=o)):(zt=s,s=o)):(zt=s,s=o)):(zt=s,s=o)}else zt=s,s=o;else zt=s,s=o;else zt=s,s=o;s===o&&(s=null),s!==o?(_t=t,r=function(t,e){return{func:t,args:e??[]}}(i,s),t=r):(zt=t,t=o)}else zt=t,t=o;else zt=t,t=o;else zt=t,t=o;else zt=t,t=o;var C;return qt--,t===o&&(r=o,0===qt&&Gt(p)),t}function Yt(){let t,r;return qt++,t=function(){let t,r,n,a;qt++,t=zt,r=de(),r!==o?(e.substr(zt,5)===C?(n=C,zt+=5):(n=o,0===qt&&Gt(A)),n!==o?(a=de(),a!==o?(_t=t,r=!1,t=r):(zt=t,t=o)):(zt=t,t=o)):(zt=t,t=o);qt--,t===o&&(r=o,0===qt&&Gt(x));return t}(),t===o&&(t=function(){let t,r,n,a;qt++,t=zt,r=de(),r!==o?(e.substr(zt,4)===v?(n=v,zt+=4):(n=o,0===qt&&Gt(y)),n!==o?(a=de(),a!==o?(_t=t,r=null,t=r):(zt=t,t=o)):(zt=t,t=o)):(zt=t,t=o);qt--,t===o&&(r=o,0===qt&&Gt(w));return t}(),t===o&&(t=function(){let t,r,n,a;qt++,t=zt,r=de(),r!==o?(e.substr(zt,4)===S?(n=S,zt+=4):(n=o,0===qt&&Gt(F)),n!==o?(a=de(),a!==o?(_t=t,r=!0,t=r):(zt=t,t=o)):(zt=t,t=o)):(zt=t,t=o);qt--,t===o&&(r=o,0===qt&&Gt(E));return t}(),t===o&&(t=function(){let t,r,n,a,i,s,l,d,p,h;if(qt++,t=zt,r=de(),r!==o)if(123===e.charCodeAt(zt)?(n="{",zt++):(n=o,0===qt&&Gt(u)),n!==o)if(a=de(),a!==o){if(i=zt,s=Zt(),s!==o){for(l=[],d=zt,p=ce(),p!==o?(h=Zt(),h!==o?(_t=d,p=L(0,h),d=p):(zt=d,d=o)):(zt=d,d=o);d!==o;)l.push(d),d=zt,p=ce(),p!==o?(h=Zt(),h!==o?(_t=d,p=L(0,h),d=p):(zt=d,d=o)):(zt=d,d=o);l!==o?(_t=i,f=s,m=l,s=Object.fromEntries([f,...m]),i=s):(zt=i,i=o)}else zt=i,i=o;i===o&&(i=null),i!==o?(s=ce(),s===o&&(s=null),s!==o?(l=de(),l!==o?(125===e.charCodeAt(zt)?(d="}",zt++):(d=o,0===qt&&Gt(c)),d!==o?(p=de(),p!==o?(_t=t,r=i??{},t=r):(zt=t,t=o)):(zt=t,t=o)):(zt=t,t=o)):(zt=t,t=o)):(zt=t,t=o)}else zt=t,t=o;else zt=t,t=o;else zt=t,t=o;var f,m;qt--,t===o&&(r=o,0===qt&&Gt(k));return t}(),t===o&&(t=function(){let t,r,n,a,i,s,l,u,c,d;if(qt++,t=zt,r=de(),r!==o)if(91===e.charCodeAt(zt)?(n="[",zt++):(n=o,0===qt&&Gt(U)),n!==o)if(a=de(),a!==o){if(i=zt,s=Yt(),s!==o){for(l=[],u=zt,c=ce(),c!==o?(d=Yt(),d!==o?(_t=u,c=I(0,d),u=c):(zt=u,u=o)):(zt=u,u=o);u!==o;)l.push(u),u=zt,c=ce(),c!==o?(d=Yt(),d!==o?(_t=u,c=I(0,d),u=c):(zt=u,u=o)):(zt=u,u=o);l!==o?(_t=i,p=l,s=[s,...p],i=s):(zt=i,i=o)}else zt=i,i=o;i===o&&(i=null),i!==o?(s=ce(),s===o&&(s=null),s!==o?(l=de(),l!==o?(93===e.charCodeAt(zt)?(u="]",zt++):(u=o,0===qt&&Gt(R)),u!==o?(c=de(),c!==o?(_t=t,r=i??[],t=r):(zt=t,t=o)):(zt=t,t=o)):(zt=t,t=o)):(zt=t,t=o)):(zt=t,t=o)}else zt=t,t=o;else zt=t,t=o;else zt=t,t=o;var p;qt--,t===o&&(r=o,0===qt&&Gt(q));return t}(),t===o&&(t=function(){let t,r,n,a,i,s,l,u,c;qt++,t=zt,45===e.charCodeAt(zt)?(r=J,zt++):(r=o,0===qt&&Gt(K));r===o&&(r=null);if(r!==o)if(n=re(),n!==o){if(a=zt,46===e.charCodeAt(zt)?(i=T,zt++):(i=o,0===qt&&Gt(D)),i!==o){if(s=[],l=ue(),l!==o)for(;l!==o;)s.push(l),l=ue();else s=o;s!==o?(i=[i,s],a=i):(zt=a,a=o)}else zt=a,a=o;if(a===o&&(a=null),a!==o){if(i=zt,G.test(e.charAt(zt))?(s=e.charAt(zt),zt++):(s=o,0===qt&&Gt(B)),s!==o)if(45===e.charCodeAt(zt)?(l=J,zt++):(l=o,0===qt&&Gt(K)),l===o&&(43===e.charCodeAt(zt)?(l="+",zt++):(l=o,0===qt&&Gt(W))),l===o&&(l=null),l!==o){if(u=[],c=ue(),c!==o)for(;c!==o;)u.push(c),c=ue();else u=o;u!==o?(s=[s,l,u],i=s):(zt=i,i=o)}else zt=i,i=o;else zt=i,i=o;i===o&&(i=null),i!==o?(_t=t,r=parseFloat(Ut()),t=r):(zt=t,t=o)}else zt=t,t=o}else zt=t,t=o;else zt=t,t=o;qt--,t===o&&(r=o,0===qt&&Gt(V));return t}(),t===o&&(t=ne())))))),qt--,t===o&&(r=o,0===qt&&Gt(b)),t}function Zt(){let t,r,n,a;return qt++,t=zt,r=ne(),r===o&&(r=te()),r!==o?(n=function(){let t,r,n,a;t=zt,r=de(),r!==o?(58===e.charCodeAt(zt)?(n=":",zt++):(n=o,0===qt&&Gt(M)),n!==o?(a=de(),a!==o?(r=[r,n,a],t=r):(zt=t,t=o)):(zt=t,t=o)):(zt=t,t=o);return t}(),n!==o?(a=Yt(),a!==o?(_t=t,r=[r,a],t=r):(zt=t,t=o)):(zt=t,t=o)):(zt=t,t=o),qt--,t===o&&(r=o,0===qt&&Gt(N)),t}function te(){let t,r,n,a,i,s;if(qt++,t=zt,r=ee(),r!==o){for(n=[],a=zt,46===e.charCodeAt(zt)?(i=T,zt++):(i=o,0===qt&&Gt(D)),i!==o?(s=ee(),s!==o?(i=[i,s],a=i):(zt=a,a=o)):(zt=a,a=o);a!==o;)n.push(a),a=zt,46===e.charCodeAt(zt)?(i=T,zt++):(i=o,0===qt&&Gt(D)),i!==o?(s=ee(),s!==o?(i=[i,s],a=i):(zt=a,a=o)):(zt=a,a=o);n!==o?(_t=t,r=$(),t=r):(zt=t,t=o)}else zt=t,t=o;return qt--,t===o&&(r=o,0===qt&&Gt(H)),t}function ee(){let t,r,n,a,i;if(qt++,t=zt,r=zt,z.test(e.charAt(zt))?(n=e.charAt(zt),zt++):(n=o,0===qt&&Gt(_)),n!==o){for(a=[],j.test(e.charAt(zt))?(i=e.charAt(zt),zt++):(i=o,0===qt&&Gt(P));i!==o;)a.push(i),j.test(e.charAt(zt))?(i=e.charAt(zt),zt++):(i=o,0===qt&&Gt(P));a!==o?(n=[n,a],r=n):(zt=r,r=o)}else zt=r,r=o;return r!==o&&(_t=t,r=$()),t=r,qt--,t===o&&(r=o,0===qt&&Gt(O)),t}function re(){let t,r,n,a;if(48===e.charCodeAt(zt)?(t="0",zt++):(t=o,0===qt&&Gt(Q)),t===o)if(t=zt,X.test(e.charAt(zt))?(r=e.charAt(zt),zt++):(r=o,0===qt&&Gt(Y)),r!==o){for(n=[],a=ue();a!==o;)n.push(a),a=ue();n!==o?(r=[r,n],t=r):(zt=t,t=o)}else zt=t,t=o;return t}function ne(){let t,r,n,a;if(qt++,t=zt,34===e.charCodeAt(zt)?(r='"',zt++):(r=o,0===qt&&Gt(tt)),r!==o){for(n=[],a=oe();a!==o;)n.push(a),a=oe();n!==o?(34===e.charCodeAt(zt)?(a='"',zt++):(a=o,0===qt&&Gt(tt)),a!==o?(_t=t,r=et(n),t=r):(zt=t,t=o)):(zt=t,t=o)}else zt=t,t=o;if(t===o){if(t=zt,39===e.charCodeAt(zt)?(r="'",zt++):(r=o,0===qt&&Gt(rt)),r!==o){for(n=[],a=ae();a!==o;)n.push(a),a=ae();n!==o?(39===e.charCodeAt(zt)?(a="'",zt++):(a=o,0===qt&&Gt(rt)),a!==o?(_t=t,r=et(n),t=r):(zt=t,t=o)):(zt=t,t=o)}else zt=t,t=o;if(t===o)if(t=zt,96===e.charCodeAt(zt)?(r="`",zt++):(r=o,0===qt&&Gt(nt)),r!==o){for(n=[],a=ie();a!==o;)n.push(a),a=ie();n!==o?(96===e.charCodeAt(zt)?(a="`",zt++):(a=o,0===qt&&Gt(nt)),a!==o?(_t=t,r=et(n),t=r):(zt=t,t=o)):(zt=t,t=o)}else zt=t,t=o}return qt--,t===o&&(r=o,0===qt&&Gt(Z)),t}function oe(){let t,r;return ot.test(e.charAt(zt))?(t=e.charAt(zt),zt++):(t=o,0===qt&&Gt(at)),t===o&&(t=zt,r=se(),r!==o&&(_t=t,r=r),t=r),t}function ae(){let t,r;return it.test(e.charAt(zt))?(t=e.charAt(zt),zt++):(t=o,0===qt&&Gt(st)),t===o&&(t=zt,r=se(),r!==o&&(_t=t,r=r),t=r),t}function ie(){let t,r;return lt.test(e.charAt(zt))?(t=e.charAt(zt),zt++):(t=o,0===qt&&Gt(ut)),t===o&&(t=zt,r=se(),r!==o&&(_t=t,r=r),t=r),t}function se(){let t,r,n,a,i,s,l,u;var c;return qt++,t=zt,"\\\\"===e.substr(zt,2)?(r="\\\\",zt+=2):(r=o,0===qt&&Gt(dt)),r!==o&&(_t=t,r="\\"),t=r,t===o&&(t=zt,'\\"'===e.substr(zt,2)?(r='\\"',zt+=2):(r=o,0===qt&&Gt(pt)),r!==o&&(_t=t,r='"'),t=r,t===o&&(t=zt,"\\'"===e.substr(zt,2)?(r="\\'",zt+=2):(r=o,0===qt&&Gt(ht)),r!==o&&(_t=t,r="'"),t=r,t===o&&(t=zt,"\\`"===e.substr(zt,2)?(r="\\`",zt+=2):(r=o,0===qt&&Gt(ft)),r!==o&&(_t=t,r="`"),t=r,t===o&&(t=zt,"\\b"===e.substr(zt,2)?(r="\\b",zt+=2):(r=o,0===qt&&Gt(mt)),r!==o&&(_t=t,r="\b"),t=r,t===o&&(t=zt,"\\f"===e.substr(zt,2)?(r="\\f",zt+=2):(r=o,0===qt&&Gt(gt)),r!==o&&(_t=t,r="\f"),t=r,t===o&&(t=zt,"\\n"===e.substr(zt,2)?(r="\\n",zt+=2):(r=o,0===qt&&Gt(bt)),r!==o&&(_t=t,r="\n"),t=r,t===o&&(t=zt,"\\r"===e.substr(zt,2)?(r="\\r",zt+=2):(r=o,0===qt&&Gt(wt)),r!==o&&(_t=t,r="\r"),t=r,t===o&&(t=zt,"\\t"===e.substr(zt,2)?(r="\\t",zt+=2):(r=o,0===qt&&Gt(vt)),r!==o&&(_t=t,r="\t"),t=r,t===o&&(t=zt,"\\u"===e.substr(zt,2)?(r="\\u",zt+=2):(r=o,0===qt&&Gt(yt)),r!==o?(n=zt,a=zt,i=pe(),i!==o?(s=pe(),s!==o?(l=pe(),l!==o?(u=pe(),u!==o?(i=[i,s,l,u],a=i):(zt=a,a=o)):(zt=a,a=o)):(zt=a,a=o)):(zt=a,a=o),n=a!==o?e.substring(n,zt):a,n!==o?(_t=t,c=n,r=String.fromCharCode(parseInt(c,16)),t=r):(zt=t,t=o)):(zt=t,t=o)))))))))),qt--,t===o&&(r=o,0===qt&&Gt(ct)),t}function le(){let t,r,n,a;for(qt++,t=zt,r=[],Ct.test(e.charAt(zt))?(n=e.charAt(zt),zt++):(n=o,0===qt&&Gt(At)),n===o&&(n=zt,e.substr(zt,2)===Et?(a=Et,zt+=2):(a=o,0===qt&&Gt(St)),a!==o&&(_t=n,a="{"),n=a,n===o&&(n=zt,a=se(),a!==o&&(_t=n,a=a),n=a));n!==o;)r.push(n),Ct.test(e.charAt(zt))?(n=e.charAt(zt),zt++):(n=o,0===qt&&Gt(At)),n===o&&(n=zt,e.substr(zt,2)===Et?(a=Et,zt+=2):(a=o,0===qt&&Gt(St)),a!==o&&(_t=n,a="{"),n=a,n===o&&(n=zt,a=se(),a!==o&&(_t=n,a=a),n=a));return r!==o&&(_t=t,r=r.join("")),t=r,qt--,t===o&&(r=o,0===qt&&Gt(xt)),t}function ue(){let t,r;return qt++,kt.test(e.charAt(zt))?(t=e.charAt(zt),zt++):(t=o,0===qt&&Gt(Lt)),qt--,t===o&&(r=o,0===qt&&Gt(Ft)),t}function ce(){let t,r,n,a;return t=zt,r=de(),r!==o?(44===e.charCodeAt(zt)?(n=",",zt++):(n=o,0===qt&&Gt(Nt)),n!==o?(a=de(),a!==o?(r=[r,n,a],t=r):(zt=t,t=o)):(zt=t,t=o)):(zt=t,t=o),t}function de(){let t,r;for(qt++,t=[],Tt.test(e.charAt(zt))?(r=e.charAt(zt),zt++):(r=o,0===qt&&Gt(Dt));r!==o;)t.push(r),Tt.test(e.charAt(zt))?(r=e.charAt(zt),zt++):(r=o,0===qt&&Gt(Dt));return qt--,t===o&&(r=o,0===qt&&Gt(Ht)),t}function pe(){let t;return $t.test(e.charAt(zt))?(t=e.charAt(zt),zt++):(t=o,0===qt&&Gt(Ot)),t}if(n=i(),n!==o&&zt===e.length)return n;throw n!==o&&zt<e.length&&Gt({type:"end"}),Bt(Mt,Pt<e.length?e.charAt(Pt):null,Pt<e.length?Kt(Pt,Pt+1):Kt(Pt,Pt))}}}();class FormatEditor extends HTMLElement{static _meta={tag:"format-editor",template:document.createElement("template")};#t;#e;#r=[];get format(){return this.#r}get#n(){return 0===this.#r.length?'""':this.#r.map((t=>"txt"===t.ty?JSON.stringify(t.val):`{col ${JSON.stringify(t.col)}${t.maps.map((t=>` ➝ ${t.func}(${JSON.stringify(t.args).slice(1,-1)})`)).join("")}}`)).join("➕")}constructor(){super(),this.#t=this.attachShadow({mode:"closed"}),this.#t.appendChild(FormatEditor._meta.template.content.cloneNode(!0)),this.#e={ip:this.#t.querySelector("textarea"),op:this.#t.querySelector("pre")}}connectedCallback(){this.#e.ip.addEventListener("keyup",(()=>{try{this.#r=PEG.parse(this.#e.ip.value),this.#e.op.classList.remove("err"),this.#e.op.innerText=`Format: ${this.#n}`}catch(t){this.#r=null,this.#e.op.classList.add("err"),this.#e.op.innerText=`Error: ${t.message}`}})),this.#e.ip.addEventListener("focusin",(()=>{this.#e.op.classList.add("show")})),this.#e.ip.addEventListener("focusout",(()=>{this.#e.op.classList.remove("show"),this.#o()}))}popupError(t){this.#e.ip.setCustomValidity(t),this.#e.ip.reportValidity()}#o(){const t=new CustomEvent("change",{bubbles:!0,detail:{forCol:parseInt(this.dataset.col??"0"),format:this.#r}});this.dispatchEvent(t)}}FormatEditor._meta.template.innerHTML='<style>*{box-sizing:border-box;padding:0;margin:0}:host{display:block;box-shadow:var(--box-shadow)}#cntr{position:relative;display:grid}textarea{border:none;padding:var(--text-padding);background:var(--background);color:var(--color);height:3em;resize:vertical;font-family:Consolas,\'Courier New\',monospace}pre{display:none;position:absolute;top:calc(100% + .25em);left:.5em;max-width:calc(100% - 1em);width:calc(100% - 1em);z-index:10;white-space:pre-wrap;font-family:Consolas,\'Courier New\',monospace;padding:var(--text-padding);box-shadow:0 0 2px currentColor;background:var(--popup-background);color:var(--popup-color)}pre.err{background:var(--popup-err-background);box-shadow:var(--box-shadow)}pre.show{display:block}</style><div id="cntr"><textarea rows="1" placeholder="Enter format here"></textarea><pre>Format: ""</pre></div>',Object.freeze(FormatEditor),customElements.define(FormatEditor._meta.tag,FormatEditor);class FormatTable extends HTMLElement{static _meta={tag:"format-table",template:document.createElement("template")};#t;#a;#i=[];get columns(){return this.#i}set columns(t){this.#a.innerHTML=t.map(((t,e)=>`<div>${t}</div><format-editor ${e%2?'class="alt"':""} data-col="${e}"></format-editor>`)).join(""),this.#a.addEventListener("change",(({detail:t})=>{const e=new CustomEvent("change",{bubbles:!0,detail:t});this.dispatchEvent(e)}))}constructor(){super(),this.#t=this.attachShadow({mode:"closed"}),this.#t.appendChild(FormatTable._meta.template.content.cloneNode(!0)),this.#a=this.#t.querySelector("main")}popupError(t,e){this.#a.querySelector(`format-editor:nth-of-type(${e+1})`)?.popupError(t)}}FormatTable._meta.template.innerHTML="<style>*{box-sizing:border-box;padding:0;margin:0}:host{display:grid;grid-template-columns:min-content 1fr;gap:.3em}header{padding:var(--text-padding);box-shadow:var(--box-shadow);background:var(--head-background);color:var(--head-color);writing-mode:vertical-lr;writing-mode:sideways-lr;text-orientation:mixed;text-align:center;font-weight:700}main{display:grid;grid-template-columns:min-content 1fr;gap:.3em}main>div{display:grid;align-items:center;justify-content:center;box-shadow:var(--box-shadow);padding:var(--text-padding);background:var(--head-background);color:var(--head-color)}main>format-editor.alt{--background:var(--alt-background)}</style><header>Define Format</header><main></main>",Object.freeze(FormatTable),customElements.define(FormatTable._meta.tag,FormatTable);class DataPreview extends HTMLElement{static _meta={tag:"data-preview",template:document.createElement("template")};#t;#a;#s;#l=0;#u=0;constructor(){super(),this.#t=this.attachShadow({mode:"closed"}),this.#t.appendChild(DataPreview._meta.template.content.cloneNode(!0)),this.#a=this.#t.querySelector("section"),this.#s=this.#t.querySelector("header")}setData({head:t=null,data:e=null,showColIdx:r=!1,title:n="Preview"}={}){Array.isArray(t)&&is2DArray(e,t.length)&&(this.#s.innerText=n,this.#l=t.length,this.#u=e.length,this.#a.innerHTML=[t.map(((t,e)=>genNode(r?`{${e}} ➝ ${t}`:t,{class:"head"}))),e.map(((t,e)=>t.map(((t,r)=>genNode(t,{"data-row":e,"data-col":r,"data-row-ty":e%2?"odd":"even","data-col-ty":r%2?"odd":"even"})))))].flat(2).join(""),this.#a.style=`--row-size: ${this.#l}; --row-count: ${this.#u};`)}#c(t,e,r){const n=this.#a.querySelector(`div[data-row="${t}"][data-col="${e}"]`);n&&(n.innerText=r)}updateCol(t,e=null){if(this.#l<=t||t<0)return null;if(null===e)for(let e=0;e<this.#u;e++)this.#c(e,t,"");else for(const[r,n]of Object.entries(e))this.#c(r,t,n)}}DataPreview._meta.template.innerHTML="<style>*{box-sizing:border-box;padding:0;margin:0}:host{--row-size:1;--row-count:1;display:block}main{display:grid;grid-template-columns:min-content 1fr;grid-template-rows:1fr;gap:.5em}header{padding:var(--text-padding);box-shadow:var(--box-shadow);background:var(--head-background);color:var(--head-color);writing-mode:vertical-lr;writing-mode:sideways-lr;text-orientation:mixed;text-align:center;font-weight:700}section{display:grid;gap:.3em;grid-template-columns:max-content repeat(var(--row-count),min-content);grid-template-rows:repeat(var(--row-size),min-content);grid-auto-flow:column;justify-content:center;max-height:var(--max-preview-height);overflow-y:auto;overflow-x:auto}div{display:grid;align-items:center;justify-content:center;padding:var(--text-padding);box-shadow:var(--box-shadow);background:var(--background);color:var(--color)}div.head{background:var(--head-background);color:var(--head-color)}div[data-row-ty=even][data-col-ty=even],div[data-row-ty=odd][data-col-ty=odd]{background:var(--alt-background)}</style><main><header>Preview</header><section></section></main>",Object.freeze(DataPreview),customElements.define(DataPreview._meta.tag,DataPreview);class DataMapper extends HTMLElement{static _meta={tag:"data-mapper",template:document.createElement("template")};#t;#e;#d;#p;#h;#l;#u;#f;#m;#g=!1;#b;#w;#v=[];constructor(){super(),this.#t=this.attachShadow({mode:"closed"}),this.#t.appendChild(DataMapper._meta.template.content.cloneNode(!0)),this.#e={ip:this.#t.querySelector("data-preview"),format:this.#t.querySelector("format-table"),op:this.#t.querySelector("data-preview:nth-of-type(2)")}}setData({inputHead:t=[],data:e=[],outputHead:r=[],maxPreviewLen:n=10,allowConstant:o=!0,allowStrOutputOnly:a=!1}={}){let i=!0;if(Array.isArray(t)&&Array.isArray(r)){is2DArray(e,t.length)||(i=!1)}else i=!1;i&&(this.#d=t,this.#h=e,this.#p=r,this.#f=n,this.#l=this.#d.length,this.#u=this.#h.length,this.#m=this.#f<this.#u?this.#f:this.#u,this.#b=o,this.#e.ip.setData({title:"Input Preview",showColIdx:!0,head:this.#d,data:this.#h.slice(0,this.#m)}),this.#e.format.columns=this.#p,this.#e.op.setData({title:"Output Preview",head:this.#p,data:((t,e)=>{const r=[];let n=[];for(let t=0;t<e;t++)n.push(""),this.#v.push([]);for(let e=0;e<t;e++)r.push([...n]);return r})(this.#m,this.#p.length)}),this.#e.format.addEventListener("change",(({detail:{forCol:t,format:e}})=>{if(null===e)this.#v[t]=void 0;else{if(0===e.length&&!this.#g)return this.#e.format.popupError("Formatter is required. Use [[empty]] for empty string",t),void(this.#v[t]=void 0);if(1===e.length&&"txt"===e[0].ty&&!this.#b)return this.#e.format.popupError("Only constant value is not allowed",t),void(this.#v[t]=void 0);const r=this.#d.length;for(let n of e)if("exp"===n.ty){if("number"!=typeof n.col){const e=this.#d.indexOf(n.col);if(-1===e)return this.#e.format.popupError(`Unknown column {${n.col}}`,t),void(this.#v[t]=void 0);n.col=e}else if(r<=n.col||n.col<0)return this.#e.format.popupError(`Unknown column {${n.col}}`,t),void(this.#v[t]=void 0);for(const{func:e}of n.maps)if(!FuncList.includes(e))return this.#e.format.popupError(`Unknown mapper used: '${e}'`,t),void(this.#v[t]=void 0)}this.#v[t]=e,this.#e.op.updateCol(t,this.#y(e,this.#m))}})))}#y(t,e=null){e??=this.#u;const r=[];for(let n=0;n<e;n++)r.push(this.#x(this.#h[n],t));return r}#x(t,e){const r=[];for(const n of e)switch(n.ty){case"txt":r.push(n.val);break;case"exp":let e=t[n.col];for(const t of n.maps)e=FormatFuncs[t.func](e,...t.args);r.push(e);break;default:break}return this.#w||1!==r.length?r.join(""):r[0]}async getFormattedData(){for(let t=0;t<this.#p.length;t++){const e=this.#v[t];if(void 0===e)return this.#e.format.popupError("Please define a correct formatter for this column",t),null;if(0===e.length&&!this.#g)return this.#e.format.popupError("Formatter is required. Use [[empty]] for empty string",t),null;if(1===e.length&&"txt"===e[0].ty&&!this.#b)return this.#e.format.popupError("Only constant value is not allowed",t),null}const t=this.#p.length,e=[];for(const r of this.#h){const n=[];for(let e=0;e<t;e++){let t=this.#x(r,this.#v[e]);t="[[empty]]"===t.trim().toLowerCase()?"":t,n.push(t)}e.push(n)}return{head:this.#p,data:e}}}DataMapper._meta.template.innerHTML="<style>*{box-sizing:border-box;padding:0;margin:0}:host{display:grid;gap:.5em;--text-padding:0.5em 0.75em;--box-shadow:0 0 2px currentColor;--background:#121212;--alt-background:#263238;--color:white;--popup-background:#0d47a1;--popup-err-background:#d50000;--popup-color:white;--head-background:#0d47a1;--head-color:white;--max-preview-height:32vh}</style><data-preview></data-preview><format-table></format-table><data-preview></data-preview>",Object.freeze(DataMapper),customElements.define(DataMapper._meta.tag,DataMapper);